<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="752px" preserveAspectRatio="none" style="width:1191px;height:752px;background:#FFFFFF;" version="1.1" viewBox="0 0 1191 752" width="1191px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="26.2969" id="_title" style="stroke:none;stroke-width:1.0;" width="478" x="358" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="468" x="363" y="27.9951">Broker de Eventos Caipora - Visão consumo de mensagens</text><rect fill="none" height="518.6641" style="stroke:#000000;stroke-width:1.5;" width="1175" x="10" y="135.5938"/><rect fill="none" height="374.1328" style="stroke:#000000;stroke-width:1.5;" width="1155" x="20" y="273.125"/><rect fill="none" height="201.7969" style="stroke:#000000;stroke-width:1.5;" width="839" x="30" y="297.2578"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="84" x2="84" y1="118.5938" y2="671.2578"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="489.5" x2="489.5" y1="118.5938" y2="671.2578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="40" y="115.292">consumidor</text><ellipse cx="84" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M84,58.7969 L84,85.7969 M71,66.7969 L97,66.7969 M84,85.7969 L71,100.7969 M84,85.7969 L97,100.7969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="40" y="683.2529">consumidor</text><ellipse cx="84" cy="695.0547" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M84,703.0547 L84,730.0547 M71,711.0547 L97,711.0547 M84,730.0547 L71,745.0547 M84,730.0547 L97,745.0547 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><path d="M462.5,92.2969 L517.5,92.2969 C522.5,92.2969 522.5,105.4453 522.5,105.4453 C522.5,105.4453 522.5,118.5938 517.5,118.5938 L462.5,118.5938 C457.5,118.5938 457.5,105.4453 457.5,105.4453 C457.5,105.4453 457.5,92.2969 462.5,92.2969 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M517.5,92.2969 C512.5,92.2969 512.5,105.4453 512.5,105.4453 C512.5,118.5938 517.5,118.5938 517.5,118.5938 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="462.5" y="110.292">broker</text><path d="M462.5,670.2578 L517.5,670.2578 C522.5,670.2578 522.5,683.4063 522.5,683.4063 C522.5,683.4063 522.5,696.5547 517.5,696.5547 L462.5,696.5547 C457.5,696.5547 457.5,683.4063 457.5,683.4063 C457.5,683.4063 457.5,670.2578 462.5,670.2578 " fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M517.5,670.2578 C512.5,670.2578 512.5,683.4063 512.5,683.4063 C512.5,696.5547 517.5,696.5547 517.5,696.5547 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="462.5" y="688.2529">broker</text><path d="M10,135.5938 L87,135.5938 L87,142.7266 L77,152.7266 L10,152.7266 L10,135.5938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="518.6641" style="stroke:#000000;stroke-width:1.5;" width="1175" x="10" y="135.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="25" y="148.6606">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="91" x="102" y="147.8042">[ciclicamente]</text><polygon fill="#181818" points="478,169.8594,488,173.8594,478,177.8594,482,173.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="84" x2="484" y1="173.8594" y2="173.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="91" y="168.7935">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="369" x="104" y="168.7935">se identificando unicamente solicita evento em um topico</text><line style="stroke:#181818;stroke-width:1.0;" x1="490" x2="532" y1="202.9922" y2="202.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="532" x2="532" y1="202.9922" y2="215.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="491" x2="532" y1="215.9922" y2="215.9922"/><polygon fill="#181818" points="501,211.9922,491,215.9922,501,219.9922,497,215.9922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="497" y="197.9263">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="510" y="197.9263">verifica se o cliente é conhecido</text><line style="stroke:#181818;stroke-width:1.0;" x1="490" x2="532" y1="245.125" y2="245.125"/><line style="stroke:#181818;stroke-width:1.0;" x1="532" x2="532" y1="245.125" y2="258.125"/><line style="stroke:#181818;stroke-width:1.0;" x1="491" x2="532" y1="258.125" y2="258.125"/><polygon fill="#181818" points="501,254.125,491,258.125,501,262.125,497,258.125" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="497" y="240.0591">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="510" y="240.0591">verifica se a estrutura esta balanceada</text><path d="M20,273.125 L84,273.125 L84,280.2578 L74,290.2578 L20,290.2578 L20,273.125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="374.1328" style="stroke:#000000;stroke-width:1.5;" width="1155" x="20" y="273.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="35" y="286.1919">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="466" x="99" y="285.3354">[estrutura está BALANCEADA - O cliente já é conhecido do ciclo anterior]</text><path d="M30,297.2578 L94,297.2578 L94,304.3906 L84,314.3906 L30,314.3906 L30,297.2578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="201.7969" style="stroke:#000000;stroke-width:1.5;" width="839" x="30" y="297.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19" x="45" y="310.3247">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="206" x="109" y="309.4683">[existe evento a ser consumido]</text><line style="stroke:#181818;stroke-width:1.0;" x1="490" x2="532" y1="335.5234" y2="335.5234"/><line style="stroke:#181818;stroke-width:1.0;" x1="532" x2="532" y1="335.5234" y2="348.5234"/><line style="stroke:#181818;stroke-width:1.0;" x1="491" x2="532" y1="348.5234" y2="348.5234"/><polygon fill="#181818" points="501,344.5234,491,348.5234,501,352.5234,497,348.5234" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="497" y="330.4575">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="347" x="510" y="330.4575">verifica a existencia de evento para o topico do cliente</text><polygon fill="#181818" points="95,373.6563,85,377.6563,95,381.6563,91,377.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="89" x2="489" y1="377.6563" y2="377.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="101" y="372.5903">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="97" x="114" y="372.5903">devolve evento</text><line style="stroke:#181818;stroke-width:1.0;" x1="84" x2="126" y1="406.7891" y2="406.7891"/><line style="stroke:#181818;stroke-width:1.0;" x1="126" x2="126" y1="406.7891" y2="419.7891"/><line style="stroke:#181818;stroke-width:1.0;" x1="85" x2="126" y1="419.7891" y2="419.7891"/><polygon fill="#181818" points="95,415.7891,85,419.7891,95,423.7891,91,419.7891" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="91" y="401.7231">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="104" y="401.7231">processa evento</text><polygon fill="#181818" points="478,444.9219,488,448.9219,478,452.9219,482,448.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="84" x2="484" y1="448.9219" y2="448.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="91" y="443.856">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="104" y="443.856">comunica broker da utilização do evento</text><line style="stroke:#181818;stroke-width:1.0;" x1="490" x2="532" y1="478.0547" y2="478.0547"/><line style="stroke:#181818;stroke-width:1.0;" x1="532" x2="532" y1="478.0547" y2="491.0547"/><line style="stroke:#181818;stroke-width:1.0;" x1="491" x2="532" y1="491.0547" y2="491.0547"/><polygon fill="#181818" points="501,487.0547,491,491.0547,501,495.0547,497,491.0547" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="497" y="472.9888">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="510" y="472.9888">marca evento como utilizado</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="1175" y1="507.0547" y2="507.0547"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="397" x="25" y="517.2651">[Estrutura esta DESBALANCEADA - O cliente NÃO é conhecido]</text><line style="stroke:#181818;stroke-width:1.0;" x1="490" x2="532" y1="541.9922" y2="541.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="532" x2="532" y1="541.9922" y2="554.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="491" x2="532" y1="554.9922" y2="554.9922"/><polygon fill="#181818" points="501,550.9922,491,554.9922,501,558.9922,497,554.9922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="9" x="497" y="536.9263">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="193" x="510" y="536.9263">limpa balanceamento anterior</text><line style="stroke:#181818;stroke-width:1.0;" x1="490" x2="532" y1="584.125" y2="584.125"/><line style="stroke:#181818;stroke-width:1.0;" x1="532" x2="532" y1="584.125" y2="597.125"/><line style="stroke:#181818;stroke-width:1.0;" x1="491" x2="532" y1="597.125" y2="597.125"/><polygon fill="#181818" points="501,593.125,491,597.125,501,601.125,497,597.125" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="497" y="579.0591">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="417" x="519" y="579.0591">trava a emissão de eventos a todos os clientes p/ se rebalancear</text><line style="stroke:#181818;stroke-width:1.0;" x1="490" x2="532" y1="626.2578" y2="626.2578"/><line style="stroke:#181818;stroke-width:1.0;" x1="532" x2="532" y1="626.2578" y2="639.2578"/><line style="stroke:#181818;stroke-width:1.0;" x1="491" x2="532" y1="639.2578" y2="639.2578"/><polygon fill="#181818" points="501,635.2578,491,639.2578,501,643.2578,497,639.2578" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="18" x="497" y="621.1919">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="644" x="519" y="621.1919">balanceia a estrutura (define partições para o novo cliente ativo e os consumidores ativos anteriores</text><!--MD5=[2f088a9a0b6f0e5980b134be44d014fd]
@startuml
title Broker de Eventos Caipora - Visão consumo de mensagens
autonumber

actor consumidor as c
queue broker as b
loop ciclicamente 
c -> b : se identificando unicamente solicita evento em um topico
b -> b : verifica se o cliente é conhecido
b -> b : verifica se a estrutura esta balanceada
alt estrutura está BALANCEADA - O cliente já é conhecido do ciclo anterior 
  alt existe evento a ser consumido 
  b -> b : verifica a existencia de evento para o topico do cliente
  b -> c : devolve evento
  c -> c : processa evento
  c -> b : comunica broker da utilização do evento
  b -> b : marca evento como utilizado
  end
else Estrutura esta DESBALANCEADA - O cliente NÃO é conhecido
  b -> b : limpa balanceamento anterior 
  b -> b : trava a emissão de eventos a todos os clientes p/ se rebalancear
  b -> b : balanceia a estrutura (define partições para o novo cliente ativo e os consumidores ativos anteriores
  
  
end
end
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>